## JWTについて

### JWTの構成

- ヘッダ、ペイロード、署名からなり、 `ヘッダ.ペイロード.署名` となる
- ヘッダ: 暗号アルゴリズムとトークンタイプ
- ペイロード: JWT発行時刻、識別子
- 署名: 署名なしトークン(`ヘッダ.ペイロード`)を暗号アルゴリズムと秘密鍵によって生成

### 検証

- JWTを署名なしトークンと署名に分離する
- 署名なしトークンを復号化した値と署名を比較する

### 認証での利用

- ユーザー登録時
  - `bcrypt`を利用してパスワードはハッシュ化してDBに保存する
  - APIはユーザーIDと秘密鍵により、トークンを生成し返却する
- ユーザー情報取得時:
  - ブラウザはクッキーにJWTを入れAPIへのリクエスト時に送信する(`Authorization`ヘッダーにJWTを設定し、APIにリクエストする場合もある)
  - APIは秘密鍵を用いてトークンを検証する
  - トークンからユーザーIDを取得し、DBに問い合わせ、返却する
- ログイン時:
  - `bcrypt`を利用して入力値の平文のパスワードとDBに保存されたハッシュ化済みのパスワードを比較し、検証をする
  - ユーザーIDと秘密鍵により、トークンを生成し返却する

## SPAにおけるクッキーの設定
### バックエンド

- Access-Control-Allow-Origin ヘッダーを指定する。ワイルドカードを指定すると失敗する
- Access-Control-Allow-Credentials ヘッダーを true を指定する
- Access-Control-Allow-Methods ヘッダーには許可するHTTPメソッドを指定する
- SetCookie ヘッダーの属性に、
  - SameSite に `none` を指定する
  - Path に `/` を指定する
  - Secure に `true` を指定する
  - HttpOnly に `true` を指定する

### フロントエンド

- withCredentials でリクエスト時にクッキーをサーバーに送信する
