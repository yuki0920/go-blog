# マイクロサービスについて

## マイクロサービスとは

- マイクロサービス: サービスを複数組み合わせて1つのアプリケーションを構成するアーキテクチャ
- サービス: 独立して開発・デプロイされるソフトウェアコンポーネント
- 実現するための技術として、コンテナ、オーケストレーション、REST、メッセージング、DevOps、CI/CD、DDDがある
- アプリケーションを個別に保守可能にする柔軟な構造がメリットとなる

## 課題

- リクエストの都度サービス感通信が生じ、パフォーマンスに影響がある
- 分散したデータストアの整合性や同期の整備コスト
- 分散コンピューティング環境の運用、監視コスト

## 特徴

- ビジネス機能に基づいたサービスとチーム編成が必要となる。コンウェイの法則の、「ITシステムの構造がプロジェクト体制を反映する」という考えとも関連が深い。
- 個別にデプロイするため、実装・テストが容易となる
- サービスごとの具体的な技術は統一しなくて良い

## DB・トランザクション

- サービスとDBが1:1となることが推奨されている。共有DBの場合、DBの変更が複数のサービスに影響し、修正が発生するため
- トランザクション: 1つのサービスで1つのDBを対象とするローカルトランザクションが推奨されている。グローバルトランザクションの場合、運用が難しく、かつサービス間が密結合になりやすい
- Sagaパターン: ローカルトランザクションとイベントパッシングを利用して、複数DB更新をする。障害発生時はキャンセル処理を呼び出し、更新適用を戻すトランザクション(保障トランザクション)を実施する。

## イベントソーシング

- 更新系データストアと参照系データストアのデータの動機をする仕組み
- ビジネスデータの履歴用データストアをイベントソースと呼ぶ。イベントソースは保管には向くが検索には向かない
- 検索用データストアをメッセージオリエンテッドミドルウェアとして用意し、更新トランザクションの際に動悸することがある

## サービスメッシュ

- 多数のサービスを管理する仕組み
- 各サービスに軽量なプロキシを設けサービスディスカバリ、トラフィックコントロール、可観測性、障害の分離、セキュリティ等の管理機能を付加する

マイクロサービスの下記課題を解決する
  - IPアドレスが再起動のたびに変更される
  - 同一サービスでも複数のバージョンを参照されている
